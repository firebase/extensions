SELECT
      key,
      id,
      timestamp,eventId,operation,data
     FROM (
      SELECT
        key,
        id,
        FIRST_VALUE(timestamp)
            OVER(PARTITION BY key ORDER BY timestamp DESC)
            AS timestamp,FIRST_VALUE(eventId)
            OVER(PARTITION BY key ORDER BY timestamp DESC)
            AS eventId,FIRST_VALUE(operation)
            OVER(PARTITION BY key ORDER BY timestamp DESC)
            AS operation,FIRST_VALUE(data)
            OVER(PARTITION BY key ORDER BY timestamp DESC)
            AS data,
        FIRST_VALUE(operation)
          OVER(PARTITION BY key ORDER BY timestamp DESC) = "DELETE"
          AS is_deleted
      FROM `test.test_dataset.test_table`
      ORDER BY key, timestamp DESC
     )
     WHERE NOT is_deleted
     GROUP BY key, id, timestamp, eventId, operation, data
