SELECT
      key,
      id
     FROM (
      SELECT
        key,
        id,
        FIRST_VALUE(operation)
          OVER(PARTITION BY key ORDER BY timestamp DESC) = "DELETE"
          AS is_deleted
      FROM `test.test_dataset.test_table`
      ORDER BY key, timestamp DESC
     )
     WHERE NOT is_deleted
     GROUP BY key, id
