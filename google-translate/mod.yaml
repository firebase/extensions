# Copyright 2018 Google LLC
#
# Use of this source code is governed by an MIT-style
# license that can be found in the LICENSE file or at
# https://opensource.org/licenses/MIT.

specVersion: v1beta1
name: google-translate
version: 1.0.0
author:
  authorName: Ashley Gau
  email: gau@google.com
  url: https://github.com/agau4779

description:
  When a message is written to the database, translate the message in the
  provided language to multiple destination languages as specified by mod user.

license: MIT

apis:
  - apiName: translate.googleapis.com
    reason:
      To use Cloud Translate to translate strings between multiple languages.

roles:
  - role: firebasedatabase.admin
    reason: allows the mod to write translations into the Realtime Database.

params:
  - param: LANGUAGES
    label: Target languages to translate into, as a comma-separated list
    description: >
      What languages would you like to translate provided text into? Please
      input these as a comma-separated list, e.g. en,es,de,fr. [List of
      supported languages.](https://cloud.google.com/translate/docs/languages)
    default: en,es,de,fr
    validationRegex: "^[a-zA-Z,-]+$"
    validationErrorMessage:
      Languages must be a comma-separated list of language codes.
    required: true
  - param: TRIGGER_PATH
    label:
      Path at which the mod listens for new messages and creates new message
      translations.
    description: >
      Where would you like to store translations?
    validationRegex: '^\S+$'
    validationErrorMessage: Database path cannot contain spaces.
    required: true

resources:
  - name: translate
    type: firebasemods.v1beta1.function
    properties:
      runtime: nodejs8
      eventTrigger:
        eventType: providers/google.firebase.database/eventTypes/ref.write
        resource: projects/_/instances/${DATABASE_INSTANCE}/refs/${TRIGGER_PATH}/{languageID}/{messageID}
