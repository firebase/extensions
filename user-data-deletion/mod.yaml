# Copyright 2019 Google LLC
#
# Use of this source code is governed by an MIT-style
# license that can be found in the LICENSE file or at
# https://opensource.org/licenses/MIT.

name: data-deletion
displayName: User Data Deletion
specVersion: v1beta1
version: 0.1.0

description: Automatically delete a user's data when they delete their account.

license: MIT
billingRequired: false
sourceUrl: https://dev-partners.googlesource.com/samples/firebase/mods/+/master/user-data-deletion
releaseNotesUrl: https://dev-partners.googlesource.com/samples/firebase/mods/+log

author:
  authorName: Firebase
  url: https://firebase.google.com
contributors:
  - authorName: Lauren Long
    url: https://github.com/laurenzlong
  - authorName: Chris Bianca
    email: chris@csfrequency.com
    url: https://github.com/chrisbianca

roles:
  - role: firebasedatabase.admin
    reason: gives mod access to Realtime Database so it can delete user data
  - role: datastore.user
    reason: gives mod access to Cloud Firestore so it can delete user data
  - role: storage.admin
    reason: gives mod access to Cloud Storage so it can delete user data

resources:
  - name: clearData
    type: firebasemods.v1beta1.function
    description:
      listen for user's being deleted, then remove user data from Cloud
      Firestore, Cloud Storage and the Realtime Database.
    properties:
      sourceDirectory: .
      location: ${LOCATION}
      eventTrigger:
        eventType: providers/firebase.auth/eventTypes/user.delete
        resource: projects/${PROJECT_ID}

params:
  - param: LOCATION
    type: select
    label: Deployment Location
    description: >-
      Where should the mod be deployed? Pick a location that is close to your
      Firestore database. See
      https://firebase.google.com/docs/functions/locations#selecting_regions_for_firestore_and_storage.
    options:
      - label: Iowa (us-central1)
        value: us-central1
      - label: South Carolina (us-east1)
        value: us-east1
      - label: Northern Virginia (us-east4)
        value: us-east4
      - label: Belgium (europe-west1)
        value: europe-west1
      - label: London (europe-west2)
        value: europe-west2
      - label: Hong Kong (asia-east2)
        value: asia-east2
      - label: Tokyo (asia-northeast1)
        value: asia-northeast1

  - param: FIRESTORE_PATHS
    type: string
    label: Firestore paths
    required: false
    description: >-
      What paths in your Firestore database contain user data? Leave empty if
      you don't use Firestore.

      Write out the full paths, separated by commas. You can represent the user
      ID of the deleted user with `{UID}`.

      For example, if you have the collections `users` and `admins`, and each
      collection has documents with user ID as document IDs. You can write
      `users/{UID},admins/{UID}`.

  - param: RTDB_PATHS
    type: string
    label: Real Time Database paths
    required: false
    description: >-
      What paths in your realtime database contain user data? Leave empty if you
      don't use realtime database.

      Write out the full paths, separated by commas. You can represent the user
      ID of the deleted user with `{UID}`.

      For example: `users/{UID},admins/{UID}`.

  - param: STORAGE_PATHS
    type: string
    label: Storage paths
    required: false
    description: >-
      Where in Google Cloud Storage do you store user data? Leave empty if you
      don't use Storage.

      Write out the full paths, separated by commas. You can represent the user
      ID of the deleted user with `{UID}`. You can use `{DEFAULT}` to represent
      the default bucket.

      For example, if you are using the default bucket, and have files with the
      naming scheme `{UID}-pic.png`, then you can write
      `{DEFAULT}/{UID}-pic.png`. If you also have files with the naming scheme
      `{UID}-logs.txt` in another bucket called `my-awesome-app-logs`, then you
      can write `{DEFAULT}/{UID}-pic.png,my-awesome-app-logs/{UID}-pic.png`.
