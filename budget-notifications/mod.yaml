# Copyright 2019 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

specVersion: v1beta1
name: budget-notifications
displayName: Send budget notifications to Zapier
version: 0.1.0

description:
  Send notifications to Zapier when your Firebase project exceeds your budget.
  Optionally, you can also configure your Zapier account to notify you and your
  team about budget overshooting via preferrred channels. (Requires a Zapier
  account)

license: Apache-2.0
billingRequired: true
sourceUrl: https://accounts.google.com/AccountChooser/signinchooser?service=gerritcodereview&continue=https%3A%2F%2Fdev-partners.googlesource.com%2Flogin%2Fsamples%2Ffirebase%2Fmods%2F%2B%2Fmaster%2Fbudget-notifications
releaseNotesUrl: https://dev-partners.googlesource.com/samples/firebase/mods/+log

author:
  authorName: Firebase
  url: https://firebase.google.com
contributors:
  - authorName: Andriana Romero
    url: https://github.com/andrianabeltran
  - authorName: Chris Bianca
    email: chris@csfrequency.com
    url: https://github.com/chrisbianca

apis:
  - apiName: cloudbilling.googleapis.com
    reason: Todo
  - apiName: pubsub.googleapis.com
    reason: Todo

roles:
  - role: firebase.developAdmin
    reason: Todo

resources:
  - name: sendBudgetNotifications
    type: firebasemods.v1beta1.function
    description: Listens for new Pub/Sub messages, then posts them to Zapier.
    properties:
      sourceDirectory: .
      location: ${LOCATION}
      eventTrigger:
        eventType: google.pubsub.topic.publish
        resource: projects/${PROJECT_ID}/topics/${MOD_INSTANCE_ID}-topic

params:
  - param: LOCATION
    type: select
    label: Deployment location
    description: >-
      Where should the mod be deployed? For help selecting a location, refer to
      the [location selection
      guide](https://firebase.google.com/docs/functions/locations).
    options:
      - label: Iowa (us-central1)
        value: us-central1
      - label: South Carolina (us-east1)
        value: us-east1
      - label: Northern Virginia (us-east4)
        value: us-east4
      - label: Belgium (europe-west1)
        value: europe-west1
      - label: London (europe-west2)
        value: europe-west2
      - label: Hong Kong (asia-east2)
        value: asia-east2
      - label: Tokyo (asia-northeast1)
        value: asia-northeast1
    default: us-central1
    required: true

  - param: ZAPIER_WEBHOOK_URL
    type: string
    label: Zapier Webhook URL
    description: i.e. `https://hooks.zapier.com/hooks/catch/XXXXXXX/YYYYYY/`
    validationRegex: ^(?:https?:\/\/hooks.zapier.com/hooks/catch)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$
    validationErrorMessage:
      Zapier url incorrect. e.g.
      (`https://hooks.zapier.com/hooks/catch/XXXXXXX/YYYYYY/`)
    required: true
