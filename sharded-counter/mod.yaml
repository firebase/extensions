specVersion: v1beta1
name: sharded-counter
version: 0.0.1
billingRequired: false

description: Auto-scalable counters for your app.

resources:
- name: shardedCounterController
  type: firebasemods.v1beta1.function
  properties:
    httpsTrigger: {}

- name: shardedCounterWorker
  type: firebasemods.v1beta1.function
  properties:
    eventTrigger:
      eventType: providers/cloud.firestore/eventTypes/document.write
      resource: projects/${PROJECT_ID}/databases/(default)/documents/${MOD_METADATA_DOC}/workers/{workerId}

env:
 - var: MOD_METADATA_DOC
   label: Mod's metadata doc
   description: >
     A path to a document where mod can keep its internal state.
   default: _firebase_mods_/sharded_counter

 - var: COUNTER_SHARDS_COLLECTION
   label: Counter Shards Collection
   description: >
     What is the unique collection name that can be used as a subcollection for counter shards.
     This name is reserved for sharded counter use only.
   default: _counter_shards_

 - var: MIN_WORKERS
   label: Min workers
   descritpion: >
     If set to 0 controller will scale down the number of workers to 0 and aggregate
     increments itself every minute for low traffic (<100 increments per minute).
     It may reduce function invocation cost at the expense of higher propagation latency.
   default: '1'
