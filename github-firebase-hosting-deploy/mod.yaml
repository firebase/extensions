# Copyright 2019 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: hosting-deploy
displayName: Deploy to Firebase hosting from Github
specVersion: v1beta1
version: 0.1.0

description: 
  When a new commit is made on a specified branch in Github, automatically delpoy the web code in a specified directory to
  Firebase Hosting. (Requires a Github account.)

license: Apache-2.0
billingRequired: true
sourceUrl: https://dev-partners.googlesource.com/samples/firebase/mods/+/master/github-firebase-hosting-deploy
releaseNotesUrl: https://dev-partners.googlesource.com/samples/firebase/mods/+log

author:
  authorName: Firebase
  url: https://firebase.google.com
  
contributors:
  - authorName: Bryan Kendall
    url: https://github.com/bkendall
  - authorName: Chris Bianca
    email: chris@csfrequency.com
    url: https://github.com/chrisbianca

apis:
  - apiName: firebasehosting.googleapis.com
    reason: allows the mod to deploy to Firebase Hosting

roles:
  - role: firebasehosting.admin
    reason: Necessary to deploy Firebase Hosting sites

resources:
  - name: deploy
    type: firebasemods.v1beta1.function
    description: triggers deployment of a GitHub repository to Firebase Hosting
    properties:
      sourceDirectory: .
      location: ${LOCATION}
      httpsTrigger: {}

params:
  - param: LOCATION
    type: select
    label: Deployment Location
    description: >-
      Where should the mod be deployed? Pick a location that is close to your
      Firestore database. See
      https://firebase.google.com/docs/functions/locations#selecting_regions_for_firestore_and_storage.
    options:
      - label: Iowa (us-central1)
        value: us-central1
      - label: South Carolina (us-east1)
        value: us-east1
      - label: Northern Virginia (us-east4)
        value: us-east4
      - label: Belgium (europe-west1)
        value: europe-west1
      - label: London (europe-west2)
        value: europe-west2
      - label: Hong Kong (asia-east2)
        value: asia-east2
      - label: Tokyo (asia-northeast1)
        value: asia-northeast1

  - param: GITHUB_REPOSITORY
    type: string
    label: Github Repository
    required: true
    validationRegex: https://github.com
    validationErrorMessage:
      This mod only supports Github URLs, please enter a URL that starts with
      `https://github.com`
    description: >-
      What is the full URL of the Github repository you want to set up
      Continuous Integration for? *For example:
      https://github.com/firebase/firebase-tools*

  - param: BRANCH
    type: string
    label: Deployment Branch
    default: master
    description: >-
      What branch should trigger deploys to Firebase Hosting?

  - param: DEPLOY_ROOT
    type: string
    label: Deployment Root
    default: public
    description: >-
      What directory in the repository should contain the source code for
      Firebase Hosting?

  - param: SITE_NAME
    type: string
    label: Site Name
    default: ${PROJECT_ID}
    description: >-
      What is the name of your site? If your project only has one site, this is
      usually the same as your project ID. You can see your site names at
      https://console.firebase.google.com/project/${PROJECT_ID}/hosting/main.
