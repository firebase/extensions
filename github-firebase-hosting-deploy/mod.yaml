# Copyright 2019 Google LLC
#
# Use of this source code is governed by an MIT-style
# license that can be found in the LICENSE file or at
# https://opensource.org/licenses/MIT.

specVersion: v1beta1
name: hosting-deploy
displayName: Automatically deploy a GitHub commit to Firebase Hosting.
version: 0.1.0
description: Automatically deploy to Firebase Hosting on Git commit.
license: MIT
billingRequired: true

apis:
  - apiName: firebasehosting.googleapis.com
    reason: allows the mod to deploy to Firebase Hosting

roles:
  - role: firebasehosting.admin
    reason: Necessary to deploy Firebase Hosting sites

resources:
  - name: deploy
    type: firebasemods.v1beta1.function
    properties:
      runtime: nodejs8
      httpsTrigger: {}
      sourceDirectory: .

params:
  - param: REPO
    type: string
    label: Github Repository
    required: true
    validationRegex: https://github.com
    validationErrorMessage:
      This mod only supports Github URLs, please enter a URL that starts with
      `https://github.com`
    description: >-
      What is the full URL of the Github repository you want to set up
      Continuous Integration for? *For example:
      https://github.com/firebase/firebase-tools*
  - param: SITE_NAME
    type: string
    label: Site Name
    default: ${PROJECT_ID}
    description: >-
      What is the name of your site? If your project only has one site, this is
      usually the same as your project ID. You can see your site names at
      https://console.firebase.google.com/project/${PROJECT_ID}/hosting/main.
  - param: BRANCH
    type: string
    label: Deployment Branch
    default: master
    description: >-
      What branch should trigger deploys to Firebase Hosting?
  - param: DEPLOY_ROOT
    type: string
    label: Deployment Root
    default: public
    description: >-
      What directory in the repository should contain the source code for
      Firebase Hosting?
